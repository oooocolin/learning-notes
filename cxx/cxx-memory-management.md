---
title: C++ 内存管理
tags:
  - cxx
  - memory-management
---
## 内存分配方式
在C++中，内存分成5个区，他们分别是堆、栈、自由存储区、全局/静态存储区和常量存储区。
- 栈：在执行函数时，函数内局部变量的存储单元都可以在栈上创建，函数执行结束时这些存储单元自动被释放。栈内存分配运算内置于处理器的指令集中，效率很高，但是分配的内存容量有限。栈的内存由编译器自动管理。栈也有指针，只不过指针由编译器维护生命周期，如果临时想使用对应指针可以使用 `&` 取地址符号，返回值是对应类型的指针。
- 堆：由 `new` 分配的内存块，内存的释放由程序员去控制，使用 `delete` 手动释放。如果程序员没有释放掉，那么在程序结束后，操作系统会自动回收。
- 自由存储区：由 `malloc` 等分配的内存块，和堆相似，但是使用 `free` 来释放内存。
- 全局/静态存储区：全局变量和静态变量被分配到同一块内存中（在以前的C语言中，全局变量又分为初始化的和未初始化的，但在C++里没有这个区分）。
- 常量存储区：是一块比较特殊的存储区，他们里面存放的是常量，不允许修改。

